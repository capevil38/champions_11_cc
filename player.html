<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Player Details – Champions 11 CC</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoM9T5aBaMRhfZ7zvjwX8vl+3Z2VXG5PM7UibXc0xos2b+M"
      crossorigin="anonymous"
    />
    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="players.html">Players</a></li>
            <li class="nav-item"><a class="nav-link" href="matches.html">Matches</a></li>
            <li class="nav-item"><a class="nav-link" href="leaderboards.html">Leaderboards</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mb-4">
      <div id="player-header" class="mb-4"></div>

      <div class="row g-4">
        <!-- Summary Cards -->
        <div class="col-12 col-lg-4" id="summary-cards"></div>

        <!-- Charts -->
        <div class="col-12 col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Runs per Match</h5>
              <canvas id="runsPerMatchChart"></canvas>
            </div>
          </div>
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Wickets per Match</h5>
              <canvas id="wicketsPerMatchChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Batting & Bowling Tables -->
      <div class="row">
        <div class="col-12">
          <h3 class="mt-4">Batting Performances</h3>
          <div class="table-responsive">
            <table id="battingTable" class="table table-striped table-hover align-middle" style="width: 100%">
              <thead class="table-dark">
                <tr>
                  <th>Match</th>
                  <th>Runs</th>
                  <th>Balls</th>
                  <th>Fours</th>
                  <th>Sixes</th>
                  <th>Strike Rate</th>
                  <th>Out</th>
                  <th>Dismissal</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col-12">
          <h3>Bowling Performances</h3>
          <div class="table-responsive">
            <table id="bowlingTable" class="table table-striped table-hover align-middle" style="width: 100%">
              <thead class="table-dark">
                <tr>
                  <th>Match</th>
                  <th>Overs</th>
                  <th>Maidens</th>
                  <th>Runs</th>
                  <th>Wickets</th>
                  <th>Economy</th>
                  <th>Fours</th>
                  <th>Sixes</th>
                  <th>Wides</th>
                  <th>No-Balls</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-auto">
      <div class="container text-center">
        <small>&copy; <span id="year"></span> Champions 11 CC</small>
      </div>
    </footer>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Q6EaC+w63pGpjz8Xc2qwstoqkMJmVmsPR7dWznHgDjncH81Q1+HUkOg1yVZ9Wbl8"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"
    ></script>
    <script
      src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const params = getQueryParams();
        const playerId = params.id;
        if (!playerId) {
          document.getElementById('player-header').innerHTML = '<h2>Player not found</h2>';
          return;
        }
        const data = await loadData();
        const player = getPlayerById(data, playerId);
        const career = getPlayerCareerStats(data, playerId);
        if (!player || !career) {
          document.getElementById('player-header').innerHTML = '<h2>Player not found</h2>';
          return;
        }
        // Header
        document.getElementById('player-header').innerHTML = `
          <h2>${player['Player Name']}</h2>
          <p class="text-muted mb-0">${player['Role']} | Bat: ${player['Bat Style']} | Bowl: ${player['Bowl Style']}</p>
        `;
        // Summary cards
        const summaryContainer = document.getElementById('summary-cards');
        const summaryStats = [
          { label: 'Matches', value: career.Matches },
          { label: 'Runs', value: career.Runs },
          { label: 'Batting Average', value: career.Avg },
          { label: 'Strike Rate', value: career.SR },
          { label: 'Wickets', value: career.Wkts },
          { label: 'Economy', value: career.Econ },
          { label: 'Catches', value: career.Catches },
        ];
        summaryStats.forEach((item) => {
          const card = document.createElement('div');
          card.className = 'mb-3';
          card.innerHTML = `
            <div class="card text-center shadow-sm">
              <div class="card-body p-3">
                <h6 class="card-subtitle mb-1">${item.label}</h6>
                <p class="fs-4 fw-bold mb-0">${item.value !== null && item.value !== undefined ? formatNumber(item.value) : '-'}</p>
              </div>
            </div>
          `;
          summaryContainer.appendChild(card);
        });
        // Prepare batting and bowling entries
        const battingEntries = data.batting.filter((b) => b['PlayerID'] == playerId);
        const bowlingEntries = data.bowling.filter((b) => b['PlayerID'] == playerId);
        // Runs per match
        const runsLabels = battingEntries.map((b) => b['MatchID']);
        const runsValues = battingEntries.map((b) => b.Runs || 0);
        // Wickets per match
        const wicketsLabels = bowlingEntries.map((b) => b['MatchID']);
        const wicketsValues = bowlingEntries.map((b) => b.Wkts || 0);
        // Charts
        const runsCtx = document.getElementById('runsPerMatchChart').getContext('2d');
        new Chart(runsCtx, {
          type: 'line',
          data: {
            labels: runsLabels,
            datasets: [
              {
                label: 'Runs',
                data: runsValues,
                fill: false,
                tension: 0.3,
                borderColor: 'rgba(54, 162, 235, 1)',
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
        const wicketsCtx = document.getElementById('wicketsPerMatchChart').getContext('2d');
        new Chart(wicketsCtx, {
          type: 'line',
          data: {
            labels: wicketsLabels,
            datasets: [
              {
                label: 'Wickets',
                data: wicketsValues,
                fill: false,
                tension: 0.3,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.5)',
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
        // Populate batting table
        const battingBody = document.querySelector('#battingTable tbody');
        battingEntries.forEach((entry) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a href="match.html?id=${entry['MatchID']}">${entry['MatchID']}</a></td>
            <td>${formatNumber(entry.Runs)}</td>
            <td>${formatNumber(entry.Balls)}</td>
            <td>${formatNumber(entry.Fours)}</td>
            <td>${formatNumber(entry.Sixes)}</td>
            <td>${entry['Strike Rate'] !== null && entry['Strike Rate'] !== undefined ? entry['Strike Rate'].toFixed(2) : '-'}</td>
            <td>${entry.Out}</td>
            <td>${entry['Dismissal Type'] || '-'}</td>
          `;
          battingBody.appendChild(tr);
        });
        // Populate bowling table
        const bowlingBody = document.querySelector('#bowlingTable tbody');
        bowlingEntries.forEach((entry) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a href="match.html?id=${entry['MatchID']}">${entry['MatchID']}</a></td>
            <td>${entry.Overs !== null && entry.Overs !== undefined ? entry.Overs : '-'}</td>
            <td>${formatNumber(entry.Maidens)}</td>
            <td>${formatNumber(entry['Bowl Runs'])}</td>
            <td>${formatNumber(entry.Wkts)}</td>
            <td>${entry.Economy !== null && entry.Economy !== undefined ? entry.Economy.toFixed(2) : '-'}</td>
            <td>${formatNumber(entry['Fours Conceded'])}</td>
            <td>${formatNumber(entry['Sixes'])}</td>
            <td>${formatNumber(entry.Wides)}</td>
            <td>${formatNumber(entry['No-Balls'])}</td>
          `;
          bowlingBody.appendChild(tr);
        });
        // Initialize DataTables
        $('#battingTable').DataTable();
        $('#bowlingTable').DataTable();
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>