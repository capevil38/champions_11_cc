<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Player Details – Champions 11 CC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="players.html" class="active">Players</a></li>
          <li><a href="matches.html">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
          <li><a href="admin.html">Upload</a></li>
        </ul>
      </div>
    </nav>
    <main class="container">
      <div class="section-heading">
        <h2>Player Insights</h2>
        <span>Career timeline & match logs</span>
      </div>
      <div id="player-header" style="margin-bottom:1rem;"></div>
      <div id="summary-cards" class="grid grid-3"></div>
      <!-- Runs per match and wickets per match -->
      <div class="grid grid-2" style="margin-top:2rem;">
        <div>
          <h3>Runs per Match</h3>
          <div id="runs-list" class="card"></div>
        </div>
        <div>
          <h3>Wickets per Match</h3>
          <div id="wickets-list" class="card"></div>
        </div>
      </div>
      <!-- Batting performances -->
      <h3 style="margin-top:2rem;">Batting Performances</h3>
      <div class="table-responsive">
        <table id="battingTable">
          <thead>
            <tr>
              <th>Match</th>
              <th>Runs</th>
              <th>Balls</th>
              <th>Fours</th>
              <th>Sixes</th>
              <th>Strike Rate</th>
              <th>Out</th>
              <th>Dismissal</th>
            </tr>
          </thead>
          <tbody id="battingBody"></tbody>
        </table>
      </div>
      <!-- Bowling performances -->
      <h3 style="margin-top:2rem;">Bowling Performances</h3>
      <div class="table-responsive">
        <table id="bowlingTable">
          <thead>
            <tr>
              <th>Match</th>
              <th>Overs</th>
              <th>Maidens</th>
              <th>Runs</th>
              <th>Wickets</th>
              <th>Economy</th>
              <th>Fours Conceded</th>
              <th>Sixes Conceded</th>
              <th>Wides</th>
              <th>No-Balls</th>
            </tr>
          </thead>
          <tbody id="bowlingBody"></tbody>
        </table>
      </div>
    </main>
    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const params = getQueryParams();
        const playerId = params.id;
        const headerEl = document.getElementById('player-header');
        if (!playerId) {
          headerEl.innerHTML = '<h2>Player not found</h2>';
          return;
        }
        const data = await loadData();
        const player = getPlayerById(data, playerId);
        const career = getCareerStatsById(data, playerId);
        if (!player || !career) {
          headerEl.innerHTML = '<h2>Player not found</h2>';
          return;
        }
        headerEl.innerHTML = `<h2>${player['Player Name']}</h2><p>${player['Role']} | Bat: ${player['Bat Style']} | Bowl: ${player['Bowl Style']}</p>`;
        // Summary cards
        const summaryItems = [
          { label: 'Matches', value: career.Matches },
          { label: 'Runs', value: career.Runs },
          { label: 'Average', value: career.Avg ? career.Avg.toFixed(2) : '-' },
          { label: 'Strike Rate', value: career.SR ? career.SR.toFixed(2) : '-' },
          { label: 'Wickets', value: career.Wkts },
          { label: 'Economy', value: career.Econ ? career.Econ.toFixed(2) : '-' },
          { label: 'Catches', value: career.Catches },
        ];
        const summaryContainer = document.getElementById('summary-cards');
        summaryItems.forEach((item) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<div class="card-title">${item.label}</div><div class="card-value">${formatNumber(item.value)}</div>`;
          summaryContainer.appendChild(card);
        });
        // Runs and wickets per match lists with progress bars
        const battingEntries = getBattingEntries(data, playerId);
        const bowlingEntries = getBowlingEntries(data, playerId);
        const maxRuns = Math.max(...battingEntries.map((e) => e.Runs || 0), 1);
        const maxWkts = Math.max(...bowlingEntries.map((e) => e.Wkts || 0), 1);
        const runsList = document.getElementById('runs-list');
        const wicketsList = document.getElementById('wickets-list');
        function buildPerfList(container, entries, field, maxVal) {
          entries.forEach((entry) => {
            const val = entry[field] || 0;
            const pct = Math.round((val / maxVal) * 100);
            const wrapper = document.createElement('div');
            wrapper.style.marginBottom = '0.5rem';
            wrapper.innerHTML = `
              <div style="display:flex; justify-content:space-between; margin-bottom:0.25rem;">
                <span><a href="match.html?id=${entry['MatchID']}">${entry['MatchID']}</a></span>
                <span>${formatNumber(val)}</span>
              </div>
              <div class="progress-bar"><div style="width:${pct}%;"></div></div>
            `;
            container.appendChild(wrapper);
          });
        }
        buildPerfList(runsList, battingEntries, 'Runs', maxRuns);
        buildPerfList(wicketsList, bowlingEntries, 'Wkts', maxWkts);
        // Batting table
        const battingBody = document.getElementById('battingBody');
        battingEntries.forEach((entry) => {
          const tr = document.createElement('tr');
          const sr = entry['Strike Rate'] != null ? parseFloat(entry['Strike Rate']).toFixed(2) : '-';
          tr.innerHTML = `
            <td><a href="match.html?id=${entry['MatchID']}">${entry['MatchID']}</a></td>
            <td>${formatNumber(entry.Runs)}</td>
            <td>${formatNumber(entry.Balls)}</td>
            <td>${formatNumber(entry.Fours)}</td>
            <td>${formatNumber(entry.Sixes)}</td>
            <td>${sr}</td>
            <td>${entry.Out}</td>
            <td>${entry['Dismissal Type'] || '-'}</td>
          `;
          battingBody.appendChild(tr);
        });
        // Bowling table
        const bowlingBody = document.getElementById('bowlingBody');
        bowlingEntries.forEach((entry) => {
          const econ = entry.Economy != null ? parseFloat(entry.Economy).toFixed(2) : '-';
          const over = entry.Overs != null ? entry.Overs : '-';
          bowlingBody.innerHTML += `
            <tr>
              <td><a href="match.html?id=${entry['MatchID']}">${entry['MatchID']}</a></td>
              <td>${over}</td>
              <td>${formatNumber(entry.Maidens)}</td>
              <td>${formatNumber(entry['Bowl Runs'])}</td>
              <td>${formatNumber(entry.Wkts)}</td>
              <td>${econ}</td>
              <td>${formatNumber(entry['Fours Conceded'])}</td>
              <td>${formatNumber(entry['Sixes'])}</td>
              <td>${formatNumber(entry.Wides)}</td>
              <td>${formatNumber(entry['No-Balls'])}</td>
            </tr>
          `;
        });
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
