<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Players – Champions 11 CC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container" style="display:flex; justify-content:space-between; align-items:center;">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="players.html" class="active">Players</a></li>
          <li><a href="matches.html">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
        </ul>
      </div>
    </nav>

    <main class="container">
      <h2>Players</h2>
      <div style="margin-bottom:1rem;">
        <input type="text" id="playerSearch" placeholder="Search players..." style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;" />
      </div>
      <div class="table-responsive">
        <table id="playersTable">
          <thead>
            <tr>
              <th data-field="name">Name</th>
              <th data-field="role">Role</th>
              <th data-field="matches">Matches</th>
              <th data-field="runs">Runs</th>
              <th data-field="wkts">Wkts</th>
              <th data-field="avg">Avg</th>
              <th data-field="econ">Econ</th>
            </tr>
          </thead>
          <tbody id="playersBody"></tbody>
        </table>
      </div>
    </main>
    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const data = await loadData();
        const searchInput = document.getElementById('playerSearch');
        const tbody = document.getElementById('playersBody');
        const headers = document.querySelectorAll('#playersTable th');
        let sortField = '';
        let ascending = true;
        function buildRows(list) {
          tbody.innerHTML = '';
          list.forEach((stat) => {
            const player = getPlayerById(data, stat['PlayerID']);
            const tr = document.createElement('tr');
            const avg = stat.Avg != null ? parseFloat(stat.Avg).toFixed(2) : '-';
            const econ = stat.Econ != null ? parseFloat(stat.Econ).toFixed(2) : '-';
            tr.innerHTML = `
              <td><a href="player.html?id=${stat['PlayerID']}">${player['Player Name']}</a></td>
              <td>${player['Role'] || '-'}</td>
              <td>${formatNumber(stat.Matches)}</td>
              <td>${formatNumber(stat.Runs)}</td>
              <td>${formatNumber(stat.Wkts)}</td>
              <td>${avg}</td>
              <td>${econ}</td>
            `;
            tbody.appendChild(tr);
          });
        }
        function updateTable() {
          let list = filterPlayers(data, searchInput.value);
          if (sortField) {
            // Map field names to stat properties or computed values
            list = list.slice().sort((a, b) => {
              let aVal, bVal;
              switch (sortField) {
                case 'name':
                  aVal = getPlayerById(data, a['PlayerID'])['Player Name'];
                  bVal = getPlayerById(data, b['PlayerID'])['Player Name'];
                  return ascending
                    ? aVal.localeCompare(bVal)
                    : bVal.localeCompare(aVal);
                case 'role':
                  aVal = getPlayerById(data, a['PlayerID'])['Role'] || '';
                  bVal = getPlayerById(data, b['PlayerID'])['Role'] || '';
                  return ascending
                    ? aVal.localeCompare(bVal)
                    : bVal.localeCompare(aVal);
                case 'matches':
                  aVal = a.Matches || 0;
                  bVal = b.Matches || 0;
                  break;
                case 'runs':
                  aVal = a.Runs || 0;
                  bVal = b.Runs || 0;
                  break;
                case 'wkts':
                  aVal = a.Wkts || 0;
                  bVal = b.Wkts || 0;
                  break;
                case 'avg':
                  aVal = a.Avg || 0;
                  bVal = b.Avg || 0;
                  break;
                case 'econ':
                  aVal = a.Econ || 0;
                  bVal = b.Econ || 0;
                  break;
                default:
                  aVal = 0;
                  bVal = 0;
              }
              return ascending ? aVal - bVal : bVal - aVal;
            });
          }
          buildRows(list);
        }
        // Header click to sort
        headers.forEach((th) => {
          th.addEventListener('click', () => {
            const field = th.getAttribute('data-field');
            if (sortField === field) {
              ascending = !ascending;
            } else {
              sortField = field;
              ascending = true;
            }
            updateTable();
          });
        });
        // Search input
        searchInput.addEventListener('input', () => {
          updateTable();
        });
        updateTable();
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>