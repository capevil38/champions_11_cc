<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Players – Champions 11 CC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container" style="display:flex; justify-content:space-between; align-items:center;">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="players.html" class="active">Players</a></li>
          <li><a href="matches.html">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
        </ul>
      </div>
    </nav>

    <main class="container">
      <h2>Players</h2>
      <div style="margin-bottom:1rem;">
        <input type="text" id="playerSearch" placeholder="Search players..." style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;" />
      </div>
      <details class="stat-section" open>
        <summary>Batting</summary>
        <div class="table-responsive">
          <table id="battingTable">
            <thead>
              <tr>
                <th data-field="name">Name</th>
                <th data-field="role">Role</th>
                <th data-field="matches">Matches</th>
                <th data-field="innings">Innings</th>
                <th data-field="runs">Runs</th>
                <th data-field="avg">Avg</th>
                <th data-field="sr">SR</th>
              </tr>
            </thead>
            <tbody id="battingBody"></tbody>
          </table>
        </div>
      </details>

      <details class="stat-section" open>
        <summary>Bowling</summary>
        <div class="table-responsive">
          <table id="bowlingTable">
            <thead>
              <tr>
                <th data-field="name">Name</th>
                <th data-field="overs">Overs</th>
                <th data-field="wkts">Wkts</th>
                <th data-field="econ">Econ</th>
                <th data-field="maidens">Maidens</th>
                <th data-field="dots">Dot Balls</th>
              </tr>
            </thead>
            <tbody id="bowlingBody"></tbody>
          </table>
        </div>
      </details>

      <details class="stat-section" open>
        <summary>Fielding</summary>
        <div class="table-responsive">
          <table id="fieldingTable">
            <thead>
              <tr>
                <th data-field="name">Name</th>
                <th data-field="matches">Matches</th>
                <th data-field="catches">Catches</th>
                <th data-field="runouts">Run Outs</th>
                <th data-field="stumpings">Stumpings</th>
              </tr>
            </thead>
            <tbody id="fieldingBody"></tbody>
          </table>
        </div>
      </details>
    </main>
    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const data = await loadData();
        const searchInput = document.getElementById('playerSearch');
        const formatDecimal = (value) =>
          value != null ? parseFloat(value).toFixed(2) : '-';
        const sections = {
          batting: {
            tbody: document.getElementById('battingBody'),
            headers: document.querySelectorAll('#battingTable th'),
            sortField: '',
            ascending: true,
            getValue: (stat, field) => {
              const player = getPlayerById(data, stat['PlayerID']);
              switch (field) {
                case 'name':
                  return player ? player['Player Name'].toLowerCase() : '';
                case 'role':
                  return player && player['Role']
                    ? player['Role'].toLowerCase()
                    : '';
                case 'matches':
                  return stat.Matches || 0;
                case 'innings':
                  return stat.Innings || 0;
                case 'runs':
                  return stat.Runs || 0;
                case 'avg':
                  return stat.Avg || 0;
                case 'sr':
                  return stat.SR || 0;
                default:
                  return 0;
              }
            },
            buildRow: (stat, player) => `
              <td><a href="player.html?id=${stat['PlayerID']}">${player['Player Name']}</a></td>
              <td>${player['Role'] || '-'}</td>
              <td>${formatNumber(stat.Matches)}</td>
              <td>${formatNumber(stat.Innings)}</td>
              <td>${formatNumber(stat.Runs)}</td>
              <td>${formatDecimal(stat.Avg)}</td>
              <td>${formatDecimal(stat.SR)}</td>
            `,
          },
          bowling: {
            tbody: document.getElementById('bowlingBody'),
            headers: document.querySelectorAll('#bowlingTable th'),
            sortField: '',
            ascending: true,
            getValue: (stat, field) => {
              const player = getPlayerById(data, stat['PlayerID']);
              switch (field) {
                case 'name':
                  return player ? player['Player Name'].toLowerCase() : '';
                case 'overs':
                  return stat.Overs != null ? parseFloat(stat.Overs) : 0;
                case 'wkts':
                  return stat.Wkts || 0;
                case 'econ':
                  return stat.Econ || 0;
                case 'maidens':
                  return stat.Maidens || 0;
                case 'dots':
                  return stat['Dot Balls'] || 0;
                default:
                  return 0;
              }
            },
            buildRow: (stat, player) => `
              <td><a href="player.html?id=${stat['PlayerID']}">${player['Player Name']}</a></td>
              <td>${stat.Overs != null ? stat.Overs : '-'}</td>
              <td>${formatNumber(stat.Wkts)}</td>
              <td>${formatDecimal(stat.Econ)}</td>
              <td>${formatNumber(stat.Maidens)}</td>
              <td>${formatNumber(stat['Dot Balls'])}</td>
            `,
          },
          fielding: {
            tbody: document.getElementById('fieldingBody'),
            headers: document.querySelectorAll('#fieldingTable th'),
            sortField: '',
            ascending: true,
            getValue: (stat, field) => {
              const player = getPlayerById(data, stat['PlayerID']);
              switch (field) {
                case 'name':
                  return player ? player['Player Name'].toLowerCase() : '';
                case 'matches':
                  return stat.Matches || 0;
                case 'catches':
                  return stat.Catches || 0;
                case 'runouts':
                  return stat['Run Outs'] || 0;
                case 'stumpings':
                  return stat.Stumpings || 0;
                default:
                  return 0;
              }
            },
            buildRow: (stat, player) => `
              <td><a href="player.html?id=${stat['PlayerID']}">${player['Player Name']}</a></td>
              <td>${formatNumber(stat.Matches)}</td>
              <td>${formatNumber(stat.Catches)}</td>
              <td>${formatNumber(stat['Run Outs'])}</td>
              <td>${formatNumber(stat.Stumpings)}</td>
            `,
          },
        };
        function sortSection(list, section) {
          if (!section.sortField) return list.slice();
          return list.slice().sort((a, b) => {
            const aVal = section.getValue(a, section.sortField);
            const bVal = section.getValue(b, section.sortField);
            if (typeof aVal === 'string' || typeof bVal === 'string') {
              const aStr = (aVal || '').toString();
              const bStr = (bVal || '').toString();
              return section.ascending
                ? aStr.localeCompare(bStr)
                : bStr.localeCompare(aStr);
            }
            return section.ascending ? aVal - bVal : bVal - aVal;
          });
        }
        function renderSection(section, list) {
          section.tbody.innerHTML = '';
          list.forEach((stat) => {
            const player = getPlayerById(data, stat['PlayerID']);
            if (!player) return;
            const tr = document.createElement('tr');
            tr.innerHTML = section.buildRow(stat, player);
            section.tbody.appendChild(tr);
          });
        }
        function updateTables() {
          const filtered = filterPlayers(data, searchInput.value);
          Object.values(sections).forEach((section) => {
            const rows = sortSection(filtered, section);
            renderSection(section, rows);
          });
        }
        Object.values(sections).forEach((section) => {
          section.headers.forEach((th) => {
            const field = th.getAttribute('data-field');
            th.addEventListener('click', () => {
              if (section.sortField === field) {
                section.ascending = !section.ascending;
              } else {
                section.sortField = field;
                section.ascending = true;
              }
              updateTables();
            });
          });
        });
        searchInput.addEventListener('input', updateTables);
        updateTables();
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
