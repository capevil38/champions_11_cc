<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Match Details – Champions 11 CC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container" style="display:flex; justify-content:space-between; align-items:center;">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="players.html">Players</a></li>
          <li><a href="matches.html" class="active">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
        </ul>
      </div>
    </nav>
    <main class="container">
      <div id="match-header" style="margin-bottom:1rem;"></div>
      <div id="match-cards" class="grid grid-3"></div>
      <h3 style="margin-top:2rem;">Batting Scorecard</h3>
      <div class="table-responsive">
        <table id="battingTable">
          <thead>
            <tr>
              <th>Player</th>
              <th>Runs</th>
              <th>Balls</th>
              <th>Fours</th>
              <th>Sixes</th>
              <th>Strike Rate</th>
              <th>Out</th>
              <th>Dismissal</th>
            </tr>
          </thead>
          <tbody id="battingBody"></tbody>
        </table>
      </div>
      <h3 style="margin-top:2rem;">Bowling Scorecard</h3>
      <div class="table-responsive">
        <table id="bowlingTable">
          <thead>
            <tr>
              <th>Player</th>
              <th>Overs</th>
              <th>Maidens</th>
              <th>Runs</th>
              <th>Wickets</th>
              <th>Economy</th>
              <th>Fours Conceded</th>
              <th>Sixes Conceded</th>
              <th>Wides</th>
              <th>No-Balls</th>
            </tr>
          </thead>
          <tbody id="bowlingBody"></tbody>
        </table>
      </div>
      <h3 style="margin-top:2rem;">Fielding</h3>
      <div class="table-responsive">
        <table id="fieldingTable">
          <thead>
            <tr>
              <th>Player</th>
              <th>Catches</th>
              <th>Run Outs</th>
              <th>Stumpings</th>
            </tr>
          </thead>
          <tbody id="fieldingBody"></tbody>
        </table>
      </div>
    </main>
    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const params = getQueryParams();
        const matchId = params.id;
        const headerEl = document.getElementById('match-header');
        if (!matchId) {
          headerEl.innerHTML = '<h2>Match not found</h2>';
          return;
        }
        const data = await loadData();
        const match = data.matches.find((m) => m.MatchID == matchId);
        if (!match) {
          headerEl.innerHTML = '<h2>Match not found</h2>';
          return;
        }
        headerEl.innerHTML = `<h2>Match vs ${match.Opponent}</h2><p>${match.Date || ''} | ${match.Venue || ''}</p>`;
        // Info cards
        const info = [
          { label: 'Result', value: match['Match Result'] },
          { label: 'Match Type', value: match['MatchType'] },
          { label: 'Overs', value: match['Overs'] },
          { label: 'Innings', value: match['Innings Type'] },
          { label: 'Toss', value: match['Toss'] },
          { label: 'Decision', value: match['Decision'] },
          { label: 'Tournament', value: match['Tournament'] },
          { label: 'Team Runs/Wkts', value: `${formatNumber(match['Team Runs'])}/${formatNumber(match['Team Wickets Lost'])}` },
          { label: 'Opp Runs/Wkts', value: `${formatNumber(match['Opponent Runs'])}/${formatNumber(match['Opponent Wickets Lost'])}` },
        ];
        const cardsContainer = document.getElementById('match-cards');
        info.forEach((item) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<div class="card-title">${item.label}</div><div class="card-value">${item.value || '-'}</div>`;
          cardsContainer.appendChild(card);
        });
        // Populate batting
        const battingEntries = getEntriesForMatch(data, matchId, 'batting');
        const battingBody = document.getElementById('battingBody');
        battingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          const sr = entry['Strike Rate'] != null ? parseFloat(entry['Strike Rate']).toFixed(2) : '-';
          battingBody.innerHTML += `
            <tr>
              <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
              <td>${formatNumber(entry.Runs)}</td>
              <td>${formatNumber(entry.Balls)}</td>
              <td>${formatNumber(entry.Fours)}</td>
              <td>${formatNumber(entry.Sixes)}</td>
              <td>${sr}</td>
              <td>${entry.Out}</td>
              <td>${entry['Dismissal Type'] || '-'}</td>
            </tr>
          `;
        });
        // Populate bowling
        const bowlingEntries = getEntriesForMatch(data, matchId, 'bowling');
        const bowlingBody = document.getElementById('bowlingBody');
        bowlingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          const econ = entry.Economy != null ? parseFloat(entry.Economy).toFixed(2) : '-';
          const over = entry.Overs != null ? entry.Overs : '-';
          bowlingBody.innerHTML += `
            <tr>
              <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
              <td>${over}</td>
              <td>${formatNumber(entry.Maidens)}</td>
              <td>${formatNumber(entry['Bowl Runs'])}</td>
              <td>${formatNumber(entry.Wkts)}</td>
              <td>${econ}</td>
              <td>${formatNumber(entry['Fours Conceded'])}</td>
              <td>${formatNumber(entry['Sixes'])}</td>
              <td>${formatNumber(entry.Wides)}</td>
              <td>${formatNumber(entry['No-Balls'])}</td>
            </tr>
          `;
        });
        // Populate fielding
        const fieldingEntries = getEntriesForMatch(data, matchId, 'fielding');
        const fieldingBody = document.getElementById('fieldingBody');
        fieldingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          fieldingBody.innerHTML += `
            <tr>
              <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
              <td>${formatNumber(entry.Catches)}</td>
              <td>${formatNumber(entry['Run Outs'])}</td>
              <td>${formatNumber(entry.Stumpings)}</td>
            </tr>
          `;
        });
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
