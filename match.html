<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Match Details – Champions 11 CC</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoM9T5aBaMRhfZ7zvjwX8vl+3Z2VXG5PM7UibXc0xos2b+M"
      crossorigin="anonymous"
    />
    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="players.html">Players</a></li>
            <li class="nav-item"><a class="nav-link" href="matches.html">Matches</a></li>
            <li class="nav-item"><a class="nav-link" href="leaderboards.html">Leaderboards</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div id="match-header" class="mb-4"></div>
      <div class="row" id="match-info"></div>

      <!-- Batting Table -->
      <h3 class="mt-4">Batting Scorecard</h3>
      <div class="table-responsive mb-4">
        <table id="battingScore" class="table table-striped table-hover align-middle" style="width: 100%">
          <thead class="table-dark">
            <tr>
              <th>Player</th>
              <th>Runs</th>
              <th>Balls</th>
              <th>Fours</th>
              <th>Sixes</th>
              <th>Strike Rate</th>
              <th>Out</th>
              <th>Dismissal</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Bowling Table -->
      <h3>Bowling Scorecard</h3>
      <div class="table-responsive mb-4">
        <table id="bowlingScore" class="table table-striped table-hover align-middle" style="width: 100%">
          <thead class="table-dark">
            <tr>
              <th>Player</th>
              <th>Overs</th>
              <th>Maidens</th>
              <th>Runs</th>
              <th>Wickets</th>
              <th>Economy</th>
              <th>Fours Conceded</th>
              <th>Sixes Conceded</th>
              <th>Wides</th>
              <th>No-Balls</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Fielding Table -->
      <h3>Fielding</h3>
      <div class="table-responsive mb-4">
        <table id="fieldingTable" class="table table-striped table-hover align-middle" style="width: 100%">
          <thead class="table-dark">
            <tr>
              <th>Player</th>
              <th>Catches</th>
              <th>Run Outs</th>
              <th>Stumpings</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-auto">
      <div class="container text-center">
        <small>&copy; <span id="year"></span> Champions 11 CC</small>
      </div>
    </footer>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Q6EaC+w63pGpjz8Xc2qwstoqkMJmVmsPR7dWznHgDjncH81Q1+HUkOg1yVZ9Wbl8"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"
    ></script>
    <script
      src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"
    ></script>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const params = getQueryParams();
        const matchId = params.id;
        const header = document.getElementById('match-header');
        const infoRow = document.getElementById('match-info');
        if (!matchId) {
          header.innerHTML = '<h2>Match not found</h2>';
          return;
        }
        const data = await loadData();
        const match = data.matches.find((m) => m.MatchID == matchId);
        if (!match) {
          header.innerHTML = '<h2>Match not found</h2>';
          return;
        }
        // Header info
        header.innerHTML = `<h2>Match vs ${match.Opponent} (${match.Date || ''})</h2>`;
        // Info cards
        const details = [
          { label: 'Venue', value: match.Venue },
          { label: 'Result', value: match['Match Result'] },
          { label: 'Overs Format', value: match['Overs Format'] },
          { label: 'Innings', value: match['Innings Type'] },
          { label: 'Toss Winner', value: match['Toss Winner'] },
          { label: 'Toss Decision', value: match['Toss Decision'] },
          { label: 'Team Runs/Wkts', value: `${formatNumber(match['Team Runs'])}/${formatNumber(match['Team Wickets'])}` },
          { label: 'Opp Runs/Wkts', value: `${formatNumber(match['Opp Runs'])}/${formatNumber(match['Opp Wickets'])}` },
        ];
        details.forEach((item) => {
          const col = document.createElement('div');
          col.className = 'col-6 col-md-3 mb-3';
          col.innerHTML = `
            <div class="card h-100 text-center shadow-sm">
              <div class="card-body p-3">
                <h6 class="card-subtitle mb-1">${item.label}</h6>
                <p class="fs-5 fw-bold mb-0">${item.value || '-'}</p>
              </div>
            </div>
          `;
          infoRow.appendChild(col);
        });
        // Batting entries
        const battingEntries = getBattingForMatch(data, matchId);
        const battingBody = document.querySelector('#battingScore tbody');
        battingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
            <td>${formatNumber(entry.Runs)}</td>
            <td>${formatNumber(entry.Balls)}</td>
            <td>${formatNumber(entry.Fours)}</td>
            <td>${formatNumber(entry.Sixes)}</td>
            <td>${entry['Strike Rate'] !== null && entry['Strike Rate'] !== undefined ? entry['Strike Rate'].toFixed(2) : '-'}</td>
            <td>${entry.Out}</td>
            <td>${entry['Dismissal Type'] || '-'}</td>
          `;
          battingBody.appendChild(tr);
        });
        // Bowling entries
        const bowlingEntries = getBowlingForMatch(data, matchId);
        const bowlingBody = document.querySelector('#bowlingScore tbody');
        bowlingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
            <td>${entry.Overs !== null && entry.Overs !== undefined ? entry.Overs : '-'}</td>
            <td>${formatNumber(entry.Maidens)}</td>
            <td>${formatNumber(entry['Bowl Runs'])}</td>
            <td>${formatNumber(entry.Wkts)}</td>
            <td>${entry.Economy !== null && entry.Economy !== undefined ? entry.Economy.toFixed(2) : '-'}</td>
            <td>${formatNumber(entry['Fours Conceded'])}</td>
            <td>${formatNumber(entry['Sixes'])}</td>
            <td>${formatNumber(entry.Wides)}</td>
            <td>${formatNumber(entry['No-Balls'])}</td>
          `;
          bowlingBody.appendChild(tr);
        });
        // Fielding entries
        const fieldingEntries = getFieldingForMatch(data, matchId);
        const fieldingBody = document.querySelector('#fieldingTable tbody');
        fieldingEntries.forEach((entry) => {
          const player = getPlayerById(data, entry['PlayerID']);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><a href="player.html?id=${entry['PlayerID']}">${player['Player Name']}</a></td>
            <td>${formatNumber(entry.Catches)}</td>
            <td>${formatNumber(entry['Run Outs'])}</td>
            <td>${formatNumber(entry.Stumpings)}</td>
          `;
          fieldingBody.appendChild(tr);
        });
        $('#battingScore').DataTable({ searching: false, paging: false });
        $('#bowlingScore').DataTable({ searching: false, paging: false });
        $('#fieldingTable').DataTable({ searching: false, paging: false });
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>