<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matches – Champions 11 CC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="players.html">Players</a></li>
          <li><a href="matches.html" class="active">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
          <li><a href="admin.html">Upload</a></li>
        </ul>
      </div>
    </nav>
    <main class="container">
      <div class="section-heading">
        <h2>Matches</h2>
        <span>Filter by opponent or venue</span>
      </div>
      <div class="filter-row">
        <div>
          <label for="matchSearch">Search</label>
          <input type="text" id="matchSearch" class="input-control" placeholder="Search by opponent or venue..." />
        </div>
        <div>
          <label for="opponentFilter">Opponent</label>
          <select id="opponentFilter" class="input-control">
            <option value="">All Opponents</option>
          </select>
        </div>
        <div>
          <label for="venueFilter">Venue</label>
          <select id="venueFilter" class="input-control">
            <option value="">All Venues</option>
          </select>
        </div>
      </div>
      <div class="table-responsive">
        <table id="matchesTable">
          <thead>
            <tr>
              <th data-field="MatchID">Match</th>
              <th data-field="Date">Date</th>
              <th data-field="Opponent">Opponent</th>
              <th data-field="Venue">Venue</th>
              <th data-field="Match Result">Result</th>
              <th data-field="Team Runs">Team R/W</th>
              <th data-field="Opponent Runs">Opp R/W</th>
            </tr>
          </thead>
          <tbody id="matchesBody"></tbody>
        </table>
      </div>
    </main>
    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>
    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const data = await loadData();
        const searchInput = document.getElementById('matchSearch');
        const opponentSelect = document.getElementById('opponentFilter');
        const venueSelect = document.getElementById('venueFilter');
        const tbody = document.getElementById('matchesBody');
        const headers = document.querySelectorAll('#matchesTable th');
        let sortField = '';
        let ascending = true;
        const opponents = Array.from(
          new Set((data.matches || []).map((m) => m.Opponent).filter(Boolean))
        ).sort();
        const venues = Array.from(
          new Set((data.matches || []).map((m) => m.Venue).filter(Boolean))
        ).sort();
        opponents.forEach((opp) => {
          const option = document.createElement('option');
          option.value = opp;
          option.textContent = opp;
          opponentSelect.appendChild(option);
        });
        venues.forEach((venue) => {
          const option = document.createElement('option');
          option.value = venue;
          option.textContent = venue;
          venueSelect.appendChild(option);
        });
        function render(list) {
          tbody.innerHTML = '';
          list.forEach((match) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><a href="match.html?id=${match.MatchID}">${match.MatchID}</a></td>
              <td>${match.Date || '-'}</td>
              <td>${match.Opponent || '-'}</td>
              <td>${match.Venue || '-'}</td>
              <td>${match['Match Result'] || '-'}</td>
              <td>${formatNumber(match['Team Runs'])}/${formatNumber(match['Team Wickets Lost'])}</td>
              <td>${formatNumber(match['Opponent Runs'])}/${formatNumber(match['Opponent Wickets Lost'])}</td>
            `;
            tbody.appendChild(row);
          });
        }
        function applyFilters() {
          const term = searchInput.value.trim().toLowerCase();
          let list = data.matches;
          if (term) {
            list = list.filter((m) => {
              const opp = (m.Opponent || '').toLowerCase();
              const venue = (m.Venue || '').toLowerCase();
              return opp.includes(term) || venue.includes(term);
            });
          }
          if (opponentSelect.value) {
            list = list.filter((m) => m.Opponent === opponentSelect.value);
          }
          if (venueSelect.value) {
            list = list.filter((m) => m.Venue === venueSelect.value);
          }
          return list;
        }
        function update() {
          let list = applyFilters();
          if (sortField) {
            list = list.slice().sort((a, b) => {
              let aVal = a[sortField];
              let bVal = b[sortField];
              // handle numbers separately
              if (['Team Runs', 'Opponent Runs'].includes(sortField)) {
                aVal = a[sortField] || 0;
                bVal = b[sortField] || 0;
              } else if (sortField === 'Date') {
                aVal = new Date(aVal);
                bVal = new Date(bVal);
              } else {
                aVal = (aVal || '').toString().toLowerCase();
                bVal = (bVal || '').toString().toLowerCase();
              }
              if (aVal === bVal) return 0;
              return ascending ? (aVal > bVal ? 1 : -1) : (aVal > bVal ? -1 : 1);
            });
          }
          render(list);
        }
        // Sort event
        headers.forEach((th) => {
          const field = th.getAttribute('data-field');
          th.addEventListener('click', () => {
            if (sortField === field) {
              ascending = !ascending;
            } else {
              sortField = field;
              ascending = true;
            }
            update();
          });
        });
        // Search event
        searchInput.addEventListener('input', update);
        opponentSelect.addEventListener('change', update);
        venueSelect.addEventListener('change', update);
        update();
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
