<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Champions 11 CC – Team Stats</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <a class="navbar-brand" href="index.html">Champions 11 CC</a>
        <ul class="navbar-nav">
          <li><a href="index.html" class="active">Home</a></li>
          <li><a href="players.html">Players</a></li>
          <li><a href="matches.html">Matches</a></li>
          <li><a href="leaderboards.html">Leaderboards</a></li>
          <li><a href="admin.html">Upload</a></li>
        </ul>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <h1>Champions 11 Cricket Club</h1>
        <p>Season-long performance dashboards inspired by world-class cricket portals. Track every run, wicket and match moment in one dynamic hub.</p>
      </div>
    </section>

    <!-- Team Summary -->
    <main class="container">
      <div class="section-heading">
        <h2>Team Dashboard</h2>
        <span>Season Snapshot</span>
      </div>
      <div id="summary-grid" class="grid grid-3"></div>

      <!-- Top Players -->
      <div class="section-heading">
        <h2>Impact Players</h2>
        <span>Leading the charts</span>
      </div>
      <div class="grid grid-3">
        <div class="card">
          <div class="card-title">Top Run Scorers</div>
          <div id="top-runs" class="stat-feed"></div>
        </div>
        <div class="card">
          <div class="card-title">Top Wicket Takers</div>
          <div id="top-wickets" class="stat-feed"></div>
        </div>
        <div class="card">
          <div class="card-title">Top Fielders</div>
          <div id="top-fielders" class="stat-feed"></div>
        </div>
      </div>

      <div class="section-heading">
        <h2>Match Insights Dashboard</h2>
        <span>Latest highlights & run rates</span>
      </div>
      <div class="grid grid-3" id="match-insights"></div>

      <div class="section-heading">
        <h2>Venue & Opponent Analytics</h2>
        <span>Where we dominate</span>
      </div>
      <div class="grid grid-2">
        <div class="card">
          <div class="card-title">Top Venues</div>
          <div id="venue-analytics" class="stat-feed"></div>
        </div>
        <div class="card">
          <div class="card-title">Best Opponents</div>
          <div id="opponent-analytics" class="stat-feed"></div>
        </div>
      </div>
    </main>

    <footer>
      © <span id="year"></span> Champions 11 CC
    </footer>

    <script src="script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const data = await loadData();
        // Team summary cards
        const summary = data.team_stats && data.team_stats.length ? data.team_stats[0] : {};
        const matches = data.matches || [];
        const totals = matches.map((m) => m['Team Runs'] || 0);
        const wickets = matches.map((m) => m['Team Wickets Lost'] || 0);
        const highestTeamTotal = totals.length ? Math.max(...totals) : null;
        const lowestTeamTotal = totals.length ? Math.min(...totals) : null;
        const avgScore =
          totals.length > 0 ? (totals.reduce((sum, val) => sum + val, 0) / totals.length).toFixed(1) : null;
        const avgWkts =
          wickets.length > 0
            ? (wickets.reduce((sum, val) => sum + val, 0) / wickets.length).toFixed(1)
            : null;
        const items = [
          { label: 'Matches', value: summary.Matches },
          { label: 'Wins', value: summary.Won },
          { label: 'Losses', value: summary.Lost },
          { label: 'Ties', value: summary.Tie },
          { label: 'No Result', value: summary['No Result'] },
          { label: 'Highest Total', value: highestTeamTotal },
          { label: 'Lowest Total', value: lowestTeamTotal },
          { label: 'Avg Score', value: avgScore },
          { label: 'Avg Wkts Lost', value: avgWkts },
        ];
        const grid = document.getElementById('summary-grid');
        items.forEach((item) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<div class="card-title">${item.label}</div><div class="card-value">${formatNumber(item.value)}</div>`;
          grid.appendChild(card);
        });

        // Top runs and wickets
        const topRuns = getTopPlayers(data, 'Runs', 5);
        const topWkts = getTopPlayers(data, 'Wkts', 5);
        const topFielders = getTopPlayers(data, 'Catches', 5);
        const runsContainer = document.getElementById('top-runs');
        const wicketsContainer = document.getElementById('top-wickets');
        const fieldersContainer = document.getElementById('top-fielders');
        // function to build list
        function buildList(container, arr, field) {
          const list = document.createElement('ul');
          list.style.listStyle = 'none';
          list.style.padding = '0';
          arr.forEach((stat, i) => {
            const player = getPlayerById(data, stat['PlayerID']);
            const li = document.createElement('li');
            li.style.marginBottom = '0.5rem';
            li.innerHTML = `<strong>${i + 1}. <a href="player.html?id=${stat['PlayerID']}">${player['Player Name']}</a></strong><span>${formatNumber(stat[field])}</span>`;
            list.appendChild(li);
          });
          container.appendChild(list);
        }
        buildList(runsContainer, topRuns, 'Runs');
        buildList(wicketsContainer, topWkts, 'Wkts');
        buildList(fieldersContainer, topFielders, 'Catches');

        const insights = Analytics.getMatchInsights(data);
        const insightsContainer = document.getElementById('match-insights');
        if (insights && insightsContainer) {
          const { latest, topBatter, topBowler, teamRunRate, oppRunRate } = insights;
          const matchCard = document.createElement('div');
          matchCard.className = 'card';
          matchCard.innerHTML = `
            <div class="card-title">Last Match</div>
            <h3>${latest.Opponent}</h3>
            <p>${latest.Date} • ${latest.Venue || 'Unknown Venue'}</p>
            <p>Result: <strong>${latest['Match Result'] || 'N/A'}</strong></p>
            <p>Run Rates: Us ${teamRunRate || '-'} vs Them ${oppRunRate || '-'}</p>
          `;
          const batterCard = document.createElement('div');
          const batterPlayer = topBatter ? getPlayerById(data, topBatter.PlayerID) : null;
          batterCard.className = 'card';
          batterCard.innerHTML = `
            <div class="card-title">Top Batter</div>
            <h3>${batterPlayer ? batterPlayer['Player Name'] : 'N/A'}</h3>
            <p>Runs: <strong>${formatNumber(topBatter ? topBatter.Runs : '-')}</strong></p>
            <p>Match: ${topBatter ? topBatter.MatchID : '-'}</p>
          `;
          const bowlerCard = document.createElement('div');
          const bowlerPlayer = topBowler ? getPlayerById(data, topBowler.PlayerID) : null;
          bowlerCard.className = 'card';
          bowlerCard.innerHTML = `
            <div class="card-title">Top Bowler</div>
            <h3>${bowlerPlayer ? bowlerPlayer['Player Name'] : 'N/A'}</h3>
            <p>Wkts: <strong>${formatNumber(topBowler ? topBowler.Wkts : '-')}</strong></p>
            <p>Economy: ${topBowler && topBowler.Economy != null ? parseFloat(topBowler.Economy).toFixed(2) : '-'}</p>
          `;
          insightsContainer.appendChild(matchCard);
          insightsContainer.appendChild(batterCard);
          insightsContainer.appendChild(bowlerCard);
        }

        function buildAnalyticsFeed(containerId, entries, formatter) {
          const container = document.getElementById(containerId);
          if (!container) return;
          const list = document.createElement('ul');
          list.style.listStyle = 'none';
          list.style.padding = '0';
          entries.forEach((entry, index) => {
            const li = document.createElement('li');
            li.style.display = 'flex';
            li.style.justifyContent = 'space-between';
            li.style.padding = '0.35rem 0';
            li.innerHTML = `<strong>${index + 1}. ${formatter.label(entry)}</strong><span>${formatter.value(entry)}</span>`;
            list.appendChild(li);
          });
          container.appendChild(list);
        }

        const venueAnalytics = Analytics.computeVenueAnalytics(data, 5);
        const opponentAnalytics = Analytics.computeOpponentAnalytics(data, 5);
        buildAnalyticsFeed('venue-analytics', venueAnalytics, {
          label: (entry) => entry.venue,
          value: (entry) => `${entry.average || '-'} avg`,
        });
        buildAnalyticsFeed('opponent-analytics', opponentAnalytics, {
          label: (entry) => entry.opponent,
          value: (entry) => `${entry.winPct}% wins`,
        });

        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
